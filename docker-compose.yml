version: '3.4'

services:
  strava-api:
    container_name: strava-api
    image: ${DOCKER_REGISTRY-}strava-api
    ports:
      - "8001:80"
      - "8002:433"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DbConnection=${StravaApiDbConnectionString}

      - TokenSettings__Key=${TokenKey}
      - TokenSettings__Issuer=${TokenIssuer}
      - TokenSettings__ExpiresInDays=${TokenExpiresInDays}

      - StravaSettings__ClientId=${StravaClientId}
      - StravaSettings__ClientSecret=${StravaClientSecret}
    build:
      context: .
      dockerfile: src/Services/Strava/Strava.Api/Dockerfile
    depends_on:
      - db_server

  athletes-api:
    container_name: athletes-api
    image: ${DOCKER_REGISTRY-}athletes-api
    ports:
      - "8003:80"
      - "8004:433"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DbConnection=${AthletesApiDbConnectionString}
    build:
      context: .
      dockerfile: src/Services/Athletes/Athletes.Api/Dockerfile
    depends_on:
      - db_server

  db_server:
    container_name: sqlserver
    image: mcr.microsoft.com/mssql/server:2022-latest
    ports:
      - 1433:1433
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${DbPassword}
